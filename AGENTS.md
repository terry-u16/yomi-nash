# Repository Guidelines

## Project Overview
- Mixed-strategy Nash equilibria for two-player zero-sum games. Input a payoff matrix on **Home** and compute via `glpk.js`; results are visualised with probability bars, expected value charts, and adjustable sliders.
- **Help** provides bilingual (ja/en) tutorials on configuring matchups, while **Theory** documents the minimax formulation with KaTeX.
- The interface uses React 19, TypeScript, Chakra UI (including `@chakra-ui/charts`), i18next, and a dark/light theme toggle backed by `next-themes`.

## Source Layout
- All source code lives in `src/`; `main.tsx` bootstraps Chakra + router, and `App.tsx` wires routes (Home / Help / Theory).
- Use the project alias `@/` (configured via `tsconfig` + `vite-tsconfig-paths`) for internal imports.
- `src/components/` holds layout shells and shared UI, with Chakra extensions under `src/components/ui/`.
- `src/pages/Home/` splits page logic into `PayoffTable`, `TableControls`, and `ResultDisplay` submodules.
- Shared logic resides in `src/lib/` (i18n, presets, persistence, parsers) and `src/utils/` (CSV/URL helpers, solver utilities); constants live in `src/constants/`, common types in `src/types/`.
- Store images or CSV examples in `src/assets/`. Place new Vitest helpers beside `src/test/utils/`. Static files for Vite go in `public/`; production builds emit to `dist/`.

## Build, Test, and Development Commands
- `pnpm install` — install dependencies before your first run.
- `pnpm dev` — start the Vite dev server with hot reload at `http://localhost:5173`.
- `pnpm build` — run `tsc -b` then emit an optimised Vite bundle.
- `pnpm preview` — serve the latest build for manual smoke testing.
- `pnpm lint` — run ESLint across `.ts/.tsx` sources.
- `pnpm format` — apply Prettier formatting rules in place.
- `pnpm test` / `pnpm test:watch` — execute the Vitest suite once or in watch mode.

## Coding Style & Naming Conventions
- Modern TypeScript + React 19. Prettier controls formatting (2 spaces, semicolons, double quotes); ESLint enforces import order and hooks rules.
- React components, Chakra wrappers, and page modules use PascalCase (`src/components/Layout.tsx`). Hooks/utilities stay camelCase. Mirror directory names when adding modules (e.g., `src/lib/parser/parseGameInputUI.ts`).
- Prefer functional components, Chakra primitives, and composition over bespoke styling. Keep translation keys under `src/lib/i18n.ts` in sync with UI strings.

## Data Handling & Internationalisation
- User input and computed results persist to `localStorage` via `persistToStorage`, restoring on boot while respecting the schema version in `src/constants/storage.ts`.
- Sharing relies on URL parameters generated by `createShareUrl` (LZ-string compression + schema version). Validate payloads with the zod parsers under `src/lib/parser/` when touching this flow.
- CSV import/export uses PapaParse (`parseCsvInput*`, `generateCsvFromGameInputUI`) and accepts UTF-8 (BOM OK). Validate numeric cells with the existing helpers.
- i18next (`src/lib/i18n.ts`) manages ja/en resources and stores the selected language. Theme toggling depends on `ColorModeProvider` in `src/components/ui/color-mode.tsx`.

## Testing Guidelines
- Vitest (jsdom) drives unit tests (`vitest.config.ts`). Follow the `src/**/__tests__` convention and suffix with `.test.ts` / `.test.tsx`.
- Reuse utilities in `src/test/utils/` (e.g., `createMockLocalStorage`) when mocking browser APIs or storage.
- Cover new code paths, especially data validation branches, localisation fallbacks, and persistence behaviours. Use describe blocks to separate locale or storage scenarios when expectations diverge.

## Commit & Pull Request Guidelines
- Use short, imperative commit subjects (≤72 chars). Communicate “what” + “why”.
- For PRs, include: (1) behaviour summary, (2) linked issues/tickets, (3) screenshots or recordings for UI tweaks, (4) a checklist showing `pnpm lint` / `pnpm test` runs. List follow-up tasks explicitly.

## Communication Preferences
リファクタリング方針や疑問点を共有するときは、Pull Request の説明やコメントを日本語で記載してください。テキストベースの応答も原則として日本語で返答してください。
